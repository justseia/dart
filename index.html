<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON to Dart Converter</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        padding: 20px;
        background-color: #f4f4f4;
      }
      textarea,
      input {
        width: 100%;
        margin-bottom: 10px;
        padding: 8px;
      }
      button {
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
      pre {
        background-color: #fff;
        padding: 10px;
        border-radius: 5px;
        user-select: none;
      }
    </style>
  </head>
  <body>
    <h1>JSON to Dart Converter</h1>
    <input
      id="classNameInput"
      type="text"
      placeholder="Enter main class name"
    />
    <textarea id="jsonInput" placeholder="Enter JSON here..."></textarea>
    <button onclick="convertJson()">Convert</button>
    <button onclick="copyToClipboard()">Copy Result</button>
    <pre id="dartOutput"></pre>

    <script>
      function jsonToDart(className, jsonString) {
        try {
          const jsonObject = JSON.parse(jsonString);
          if (Array.isArray(jsonObject)) {
            return generateDartClass(className, jsonObject[0]);
          }
          return generateDartClass(className, jsonObject);
        } catch (error) {
          console.error("Invalid JSON:", error);
          return "Error: Invalid JSON";
        }
      }

      function generateDartClass(className, jsonObject, parentKey = "") {
        let fields = "";
        let constructorParams = "";
        let fromJsonAssignments = "";
        let toJsonAssignments = "";
        let fakeDataAssignments = "";
        let nestedClasses = "";

        for (const [key, value] of Object.entries(jsonObject)) {
          let camelCaseKey = toCamelCase(key);
          let type = inferDartType(value, camelCaseKey);
          let nullable = "?";
          fields += `  final ${type}${nullable} ${camelCaseKey};\n`;
          constructorParams += `    this.${camelCaseKey},\n`;
          fromJsonAssignments += `      ${camelCaseKey}: json['${key}']${mapJsonType(
            value,
            camelCaseKey
          )},\n`;
          toJsonAssignments += `      '${key}': ${camelCaseKey},\n`;
          fakeDataAssignments += `      ${camelCaseKey}: ${generateFakeData(
            type,
            camelCaseKey
          )},\n`;

          if (
            Array.isArray(value) &&
            value.length > 0 &&
            typeof value[0] === "object"
          ) {
            let nestedClassName = capitalizeFirstLetter(camelCaseKey);
            nestedClasses +=
              generateDartClass(nestedClassName, value[0], camelCaseKey) +
              "\n\n";
          }
        }

        return `${nestedClasses}class ${className} {
${fields}
  ${className}({
${constructorParams}  });

  factory ${className}.fromJson(Map<String, dynamic> json) {
    return ${className}(
${fromJsonAssignments}    );
  }

  factory ${className}.fakeData() {
    return ${className}(
${fakeDataAssignments}    );
  }

  Map<String, dynamic> toJson() {
    return {
${toJsonAssignments}    };
  }
}`;
      }

      function inferDartType(value, key) {
        if (Array.isArray(value)) {
          if (value.length > 0 && typeof value[0] === "object") {
            return `List<${capitalizeFirstLetter(key)}>`;
          }
          return "List<dynamic>?";
        }
        if (typeof value === "string" && isValidDate(value)) {
          return "String";
        }
        switch (typeof value) {
          case "string":
            return "String";
          case "number":
            return value % 1 === 0 ? "int" : "double";
          case "boolean":
            return "bool";
          case "object":
            return value === null ? "dynamic" : "Map<String, dynamic>";
          default:
            return "dynamic";
        }
      }

      function isValidDate(dateString) {
        return !isNaN(Date.parse(dateString));
      }

      function toCamelCase(string) {
        return string.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());
      }

      function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      function mapJsonType(value, key) {
        if (Array.isArray(value)) {
          if (value.length > 0 && typeof value[0] === "object") {
            return `.map((e) => ${capitalizeFirstLetter(
              key
            )}.fromJson(e)).toList()`;
          }
          return "";
        }
        if (typeof value === "object" && value !== null) {
          return " as Map<String, dynamic>";
        }
        return "";
      }

      function generateFakeData(type, key) {
        switch (type) {
          case "String":
            return `'fake${capitalizeFirstLetter(key)}'`;
          case "int":
            return `1`;
          case "double":
            return `1.0`;
          case "bool":
            return `true`;
          case "List<dynamic>?":
            return `[]`;
          case `List<${capitalizeFirstLetter(key)}>`:
            return `List.generate(5, (_) => ${capitalizeFirstLetter(
              key
            )}.fakeData())`;
          default:
            return `${capitalizeFirstLetter(key)}.fakeData()`;
        }
      }

      function convertJson() {
        const jsonInput = document.getElementById("jsonInput").value;
        const className =
          document.getElementById("classNameInput").value || "GeneratedClass";
        const dartCode = jsonToDart(className, jsonInput);
        document.getElementById("dartOutput").innerText = dartCode;
      }

      function copyToClipboard() {
        const dartOutput = document.getElementById("dartOutput").innerText;
        navigator.clipboard
          .writeText(dartOutput)
          .then(() => {
            alert("Dart code copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
          });
      }
    </script>
  </body>
</html>
